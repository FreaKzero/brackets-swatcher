/*! adobe-swatch-importer 1.0.0 Copyright (C) 2015, Thomas Petrovic <pete@freakzero.com> 
 Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license */define(function(){function a(a){this.name="wrongFormatError",this.message=a||"",this.consoleoutput="["+this.name+"] "+this.message}function b(a){return decodeURIComponent(a.replace(/\u0000([^\\]{0,1})/gi,"$1").replace(/\u0000/gi," ").replace(/^\s+|\s+$/g,""))}function c(a){function b(a){return null===a?"00":(a=parseInt(a),0===a||isNaN(a)?"00":(a=Math.max(0,a),a=Math.min(a,255),a=Math.round(a),"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)))}return"#"+b(a[0])+b(a[1])+b(a[2])}function d(){this.version,this.amount=0,this.colors=[],this.converted=0,this.skipped=0,this.byteIndex=0,this.error=!1}function e(a){switch(a){case"aco":return new g;case"ase":return new d}}a.prototype=Error.prototype;var f=function(a){this.swatchType=a,this.name,this.origin,this.originFormat,this.rgb,this.hash};f.prototype.rgb=function(a,b,d,e){this.name=a,this.originFormat="RGB",this.origin=[b,d,e,0],"aco"===this.swatchType?this.rgb=[Math.floor(b/257),Math.floor(d/257),Math.floor(e/257)]:"ase"===this.swatchType&&(this.rgb=[256*b,256*d,256*e]),this.hash=c(this.rgb)},f.prototype.cmyk=function(a,b,d,e,f){var g;this.name=a,this.originFormat="CMYK",this.origin=[b,d,e,f],"aco"===this.swatchType?(g=1-f/65535,this.rgb=[255*(1-(1-b/65535))*(1-g),255*(1-(1-d/65535))*(1-g),255*(1-(1-e/65535))*(1-g)]):"ase"===this.swatchType&&(this.rgb=[255*(1-b)*(1-f),255*(1-d)*(1-f),255*(1-e)*(1-f)]),this.hash=c(this.rgb)},f.prototype.hsb=function(a,b,d,e){function f(a,b,c){a=Math.floor(a/65535*360)/360,b=Math.floor(b/65535*100)/100,c=Math.floor(c/65535*100)/100;var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return[Math.floor(255*d),Math.floor(255*e),Math.floor(255*f)]}this.name=a,this.originFormat="HSB",this.origin=[b,d,e],this.rgb=f(b,d,e),this.hash=c(this.rgb)};var g=function(){this.version,this.amount=0,this.colors=[],this.converted=0,this.skipped=0,this.byteIndex=0,this.error=!1};return g.prototype._readHead=function(b){try{var c=b.getInt16(2),d=10*c+5;if(this.version=b.getInt8(d),2!==this.version)throw this.error=!0,new a("Given binary data is not in an valid ACO Format");this.amount=c,this.byteIndex=10*c+9}catch(e){throw this.error=!0,new a("Given binary data is not in an valid ACO Format")}return!0},g.prototype.getColorSpace=function(a){var b={0:"RGB",1:"HSB",2:"CMYK",3:"PANTONE",4:"FOCOLTONE",5:"TRUMATCH",6:"TOYO88",7:"LAB",8:"GREYSCALE",10:"HKS"};return"undefined"!=typeof b[a]?b[a]:"INVALID COLORSPACE BYTE ["+a+"]"},g.prototype.getColors=function(a){var c;try{this._readHead(a);for(var d=0;d<this.amount;d++){c=this.byteIndex;var e=null,g=this.getColorSpace(a.getInt8(c)),h=2*a.getInt32(c+9),i=b(a.getString(h,c+13));switch(g){case"RGB":e=new f("aco"),e.rgb(i,a.getUint16(c+1),a.getUint16(c+3),a.getUint16(c+5));break;case"CMYK":this.converted++,e=new f("aco"),e.cmyk(i,a.getUint16(c+1),a.getUint16(c+3),a.getUint16(c+5),a.getUint16(c+7));break;case"HSB":e=new f("aco"),e.hsb(i,a.getUint16(c+1),a.getUint16(c+3),a.getUint16(c+5));break;default:this.skipped++,console.log("Colorspace "+g+" not supported - skipping Color")}null!==e&&this.colors.push(e),this.byteIndex=this.byteIndex+h+14}return this.colors}catch(j){throw console.error(j.consoleoutput),j}},d.prototype._readHead=function(b){try{var c=b.getString(4,0);if(this.version=b.getUint16(4)+b.getUint16(6),this.amount=b.getUint32(8),192===b.getUint8(12)){this.amount=this.amount-2;var d=b.getUint16(16);this.byteIndex=16+d+6}else this.byteIndex=16;if("ASEF"!==c)throw this.error=!0,new a("Given binary data is not in an valid ASE Format")}catch(e){throw this.error=!0,new a("Given binary data is not in an valid ASE Format")}},d.prototype.getColors=function(a){var c;try{this._readHead(a);for(var d=0;d<this.amount;d++){var e=null;c=this.byteIndex;var g=a.getUint16(c),h=2*a.getUint16(c+2);c+=4;var i=b(a.getString(h,c));console.log(c);var j=a.getString(4,c+h).trim();switch(c=c+h+4,j){case"RGB":e=new f("ase"),e.rgb(i,a.getFloat32(c),a.getFloat32(c+4),a.getFloat32(c+8));break;case"CMYK":this.converted++,e=new f("ase"),e.cmyk(i,a.getFloat32(c),a.getFloat32(c+4),a.getFloat32(c+8),a.getFloat32(c+12));break;default:this.skipped++,console.log("Colorspace "+j+" not supported - skipping Color")}null!==e&&this.colors.push(e),this.byteIndex=this.byteIndex+g+6}return this.colors}catch(k){throw console.error(k.consoleoutput),k}},e});